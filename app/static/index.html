<!DOCTYPE html>
<!-- 
  Sanctions Screening Platform Web UI
  Author: Eon (Himanshu Shekhar)
  Email: himanshu.shekhar@example.com
  GitHub: https://github.com/eon-himanshu
  Created: 2024
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanctions Screening Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: transform 0.2s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-2px);
        }
        .loading {
            display: none;
        }
        .loading.show {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-shield-alt text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold">Sanctions Screening Platform</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="showHealthCheck()" class="hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded">
                        <i class="fas fa-heartbeat mr-2"></i>Health
                    </button>
                    <button onclick="showAnalytics()" class="hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded">
                        <i class="fas fa-chart-bar mr-2"></i>Analytics
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Screening Form -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                <i class="fas fa-search mr-3"></i>Entity Screening
            </h2>
            
            <form id="screeningForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Basic Information -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-700">Basic Information</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Entity Name *
                            </label>
                            <input type="text" id="entityName" name="entityName" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Entity Type
                            </label>
                            <select id="entityType" name="entityType"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="individual">Individual</option>
                                <option value="organization">Organization</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Aliases (comma-separated)
                            </label>
                            <input type="text" id="aliases" name="aliases"
                                   placeholder="Johnny Smith, J. Smith"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <!-- Additional Information -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-700">Additional Information</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Date of Birth
                            </label>
                            <input type="date" id="dateOfBirth" name="dateOfBirth"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Nationality
                            </label>
                            <input type="text" id="nationality" name="nationality"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Passport Number
                            </label>
                            <input type="text" id="passportNumber" name="passportNumber"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Options -->
                <div class="border-t pt-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Advanced Options</h3>
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="includeMetadata" name="includeMetadata" checked
                                   class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Include detailed metadata</span>
                        </label>
                        
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-700">Threshold Override:</label>
                            <input type="number" id="thresholdOverride" name="thresholdOverride" min="0" max="1" step="0.01"
                                   placeholder="0.85" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm">
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="flex justify-center">
                    <button type="submit" 
                            class="gradient-bg text-white px-8 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity">
                        <i class="fas fa-search mr-2"></i>Screen Entity
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Loading Indicator -->
        <div id="loading" class="loading text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="mt-2 text-gray-600">Screening entity...</p>
        </div>
        
        <!-- Results Section -->
        <div id="results" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-clipboard-list mr-2"></i>Screening Results
                </h3>
                
                <div id="resultContent" class="space-y-4">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Health Check Modal -->
        <div id="healthModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">System Health</h3>
                    <div id="healthContent" class="space-y-2">
                        <!-- Health info will be populated here -->
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button onclick="hideHealthCheck()" 
                                class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Analytics Modal -->
        <div id="analyticsModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Screening Analytics</h3>
                    <div id="analyticsContent" class="space-y-2">
                        <!-- Analytics info will be populated here -->
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button onclick="hideAnalytics()" 
                                class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/v1';
        
        // Form submission
        document.getElementById('screeningForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const entityData = {
                entity: {
                    name: formData.get('entityName'),
                    entity_type: formData.get('entityType'),
                    aliases: formData.get('aliases') ? formData.get('aliases').split(',').map(s => s.trim()) : [],
                    date_of_birth: formData.get('dateOfBirth') || null,
                    nationality: formData.get('nationality') || null,
                    passport_number: formData.get('passportNumber') || null
                },
                include_metadata: formData.get('includeMetadata') === 'on',
                threshold_override: formData.get('thresholdOverride') ? parseFloat(formData.get('thresholdOverride')) : null
            };
            
            await screenEntity(entityData);
        });
        
        async function screenEntity(entityData) {
            showLoading();
            hideResults();
            
            try {
                const response = await fetch(`${API_BASE}/screen`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(entityData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                displayResults(result);
                
            } catch (error) {
                console.error('Screening failed:', error);
                displayError('Screening failed. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        function displayResults(result) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultContent');
            
            const decisionColor = {
                'clear': 'text-green-600',
                'review': 'text-yellow-600',
                'block': 'text-red-600'
            };
            
            const decisionIcon = {
                'clear': 'fas fa-check-circle',
                'review': 'fas fa-exclamation-triangle',
                'block': 'fas fa-ban'
            };
            
            contentDiv.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex items-center">
                            <i class="${decisionIcon[result.decision]} ${decisionColor[result.decision]} text-2xl mr-3"></i>
                            <div>
                                <h4 class="font-semibold">Decision</h4>
                                <p class="${decisionColor[result.decision]} font-bold text-lg">${result.decision.toUpperCase()}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold">Risk Score</h4>
                        <p class="text-2xl font-bold ${result.overall_risk_score > 0.7 ? 'text-red-600' : 'text-green-600'}">
                            ${(result.overall_risk_score * 100).toFixed(1)}%
                        </p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold">Confidence</h4>
                        <p class="text-2xl font-bold text-blue-600">
                            ${(result.confidence_score * 100).toFixed(1)}%
                        </p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-800 mb-2">Entity Information</h4>
                    <p><strong>Name:</strong> ${result.entity_name}</p>
                    <p><strong>ID:</strong> ${result.entity_id}</p>
                    <p><strong>Screening ID:</strong> ${result.screening_id}</p>
                    <p><strong>Processing Time:</strong> ${result.processing_time_ms}ms</p>
                </div>
                
                ${result.matches && result.matches.length > 0 ? `
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-800 mb-2">Matches Found (${result.matches.length})</h4>
                        <div class="space-y-2">
                            ${result.matches.map(match => `
                                <div class="border-l-4 border-red-500 pl-4 py-2 bg-red-50">
                                    <p><strong>Name:</strong> ${match.entity_name}</p>
                                    <p><strong>Source:</strong> ${match.source} - ${match.list_name}</p>
                                    <p><strong>Match Type:</strong> ${match.match_type}</p>
                                    <p><strong>Match Score:</strong> ${(match.match_score * 100).toFixed(1)}%</p>
                                    <p><strong>Risk Score:</strong> ${(match.risk_score * 100).toFixed(1)}%</p>
                                    ${match.match_details && match.match_details.reason ? 
                                        `<p><strong>Reason:</strong> ${match.match_details.reason}</p>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : '<p class="text-green-600 font-semibold">No matches found in sanctions lists.</p>'}
            `;
            
            resultsDiv.classList.remove('hidden');
        }
        
        function displayError(message) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultContent');
            
            contentDiv.innerHTML = `
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle text-red-600 text-xl mr-3"></i>
                        <p class="text-red-800 font-semibold">${message}</p>
                    </div>
                </div>
            `;
            
            resultsDiv.classList.remove('hidden');
        }
        
        async function showHealthCheck() {
            try {
                const response = await fetch('/health');
                const health = await response.json();
                
                const content = document.getElementById('healthContent');
                content.innerHTML = `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Status:</span>
                            <span class="${health.status === 'healthy' ? 'text-green-600' : 'text-red-600'} font-semibold">
                                ${health.status.toUpperCase()}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span>Database:</span>
                            <span class="${health.database_connected ? 'text-green-600' : 'text-red-600'}">
                                ${health.database_connected ? 'Connected' : 'Disconnected'}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span>BERT Model:</span>
                            <span class="${health.bert_model_loaded ? 'text-green-600' : 'text-red-600'}">
                                ${health.bert_model_loaded ? 'Loaded' : 'Not Loaded'}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span>Sanctions Lists:</span>
                            <span>${health.sanctions_lists_count}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Active Entries:</span>
                            <span>${health.active_sanctions_entries}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Version:</span>
                            <span>${health.version}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('healthModal').classList.remove('hidden');
            } catch (error) {
                console.error('Health check failed:', error);
            }
        }
        
        async function showAnalytics() {
            try {
                const response = await fetch('/analytics/screenings');
                const analytics = await response.json();
                
                const content = document.getElementById('analyticsContent');
                content.innerHTML = `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Total Screenings:</span>
                            <span class="font-semibold">${analytics.total_screenings}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Clear Decisions:</span>
                            <span class="text-green-600 font-semibold">${analytics.clear_decisions}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Review Decisions:</span>
                            <span class="text-yellow-600 font-semibold">${analytics.review_decisions}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Block Decisions:</span>
                            <span class="text-red-600 font-semibold">${analytics.block_decisions}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Avg Processing Time:</span>
                            <span>${analytics.average_processing_time_ms}ms</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Avg Risk Score:</span>
                            <span>${(analytics.average_risk_score * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('analyticsModal').classList.remove('hidden');
            } catch (error) {
                console.error('Analytics failed:', error);
            }
        }
        
        function hideHealthCheck() {
            document.getElementById('healthModal').classList.add('hidden');
        }
        
        function hideAnalytics() {
            document.getElementById('analyticsModal').classList.add('hidden');
        }
        
        function showLoading() {
            document.getElementById('loading').classList.add('show');
        }
        
        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }
        
        function hideResults() {
            document.getElementById('results').classList.add('hidden');
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            const healthModal = document.getElementById('healthModal');
            const analyticsModal = document.getElementById('analyticsModal');
            
            if (event.target === healthModal) {
                hideHealthCheck();
            }
            if (event.target === analyticsModal) {
                hideAnalytics();
            }
        }
    </script>
</body>
</html> 